<!doctype html>
<html lang="sv">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="default" />
<meta name="mobile-web-app-capable" content="yes" />
<title>LocalSport v14 ‚Äì Plats/Serie/Tid</title>

<style>
:root{
  --topbar-h:56px;
  --hint-h:26px;
  --slot-h:42px;
  --hair:#e2e8f0;
  --bg:#f0f3f8;
  --card:#fff;
  --text:#0f172a;
  --muted:#64748b;
  --accent:#16a34a;
  --link:#2563eb;
}
*{box-sizing:border-box;}
html,body{margin:0;padding:0;height:100%;background:var(--bg);font-family:-apple-system,BlinkMacSystemFont,Roboto,Arial,Helvetica;
  overscroll-behavior:none;}
.device{height:100dvh;display:flex;flex-direction:column;overflow:hidden;}

/* -------- Top bar (Layer 1) -------- */
.topbar{position:sticky;top:0;z-index:500;background:#fff;border-bottom:1px solid var(--hair);}
.topbar-inner{display:grid;grid-template-columns:1fr auto 1fr;align-items:center;padding:6px 8px;height:var(--topbar-h);}

.cluster-left,.cluster-right{display:flex;align-items:center;gap:8px;}
.cluster-center{display:flex;align-items:center;justify-content:center;gap:6px;}

.icon-btn{width:32px;height:32px;display:grid;place-items:center;border-radius:10px;border:1px solid var(--hair);cursor:pointer;}

.date-block{display:flex;flex-direction:column;align-items:center;font-weight:700;line-height:1.1;font-size:14px;}

.sort-stack{display:flex;flex-direction:column;align-items:center;border:1px solid var(--hair);border-radius:10px;padding:4px 6px;}
.sort-top{font-size:12px;font-weight:600;margin-bottom:2px;}
.sort-bottom{display:flex;gap:4px;}

.pill{padding:4px 8px;border-radius:999px;font-size:11px;font-weight:600;border:1px solid var(--hair);cursor:pointer;user-select:none;}
.pill.on{background:#dcfce7;color:var(--accent);border-color:#86efac;}
.pill.off{background:#f1f5f9;color:#94a3b8;border-color:#cbd5e1;}
.pill.lock{opacity:.6;cursor:not-allowed;}

/* -------- Hint (Layer 2) -------- */
.hint{position:sticky;top:var(--topbar-h);z-index:450;color:var(--muted);font-size:12px;text-align:center;height:var(--hint-h);
  line-height:var(--hint-h);background:#fff;border-bottom:1px solid var(--hair);}

/* -------- Sticky arena slot (Layer 3) -------- */
.group-slot{position:sticky;top:calc(var(--topbar-h) + var(--hint-h));z-index:425;height:var(--slot-h);
  display:flex;align-items:center;justify-content:space-between;padding:10px 12px;background:#fff;font-weight:700;border-bottom:1px dashed var(--hair);}

/* -------- Scroll container (Layer 4) -------- */
.scroll{flex:1;overflow-y:auto;overflow-x:hidden;-webkit-overflow-scrolling:touch;background:var(--bg);}
.arena-header{background:#fff;font-weight:700;padding:10px 12px;border-bottom:1px dashed var(--hair);
  display:flex;justify-content:space-between;}

/* -------- Game cards -------- */
.game{padding:8px 12px;border-top:1px dashed var(--hair);background:#fff;display:grid;gap:6px;}
.game-top{display:flex;align-items:center;gap:8px;flex-wrap:nowrap;}
.game-time{font-weight:700;flex:0 0 auto;white-space:nowrap;}
.game-series a{color:var(--link);font-weight:600;text-decoration:none;white-space:nowrap;}
.game-mid{text-align:center;font-weight:700;flex:1 1 auto;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.game-right{flex:0 0 auto;margin-left:auto;color:var(--muted);white-space:nowrap;font-size:12px;}

.game-bottom{display:grid;grid-template-columns:1fr auto 1fr;align-items:center;gap:6px;}
.team{display:flex;align-items:center;gap:6px;font-weight:600;}
.team.right{justify-self:start;text-align:left;}
.team-logo{width:26px;height:26px;border-radius:50%;border:1px solid var(--hair);object-fit:cover;background:#f1f5f9;}
.team-name{max-width:min(36vw,160px);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;font-size:clamp(10px,2.5vw,13px);}
.result a{min-width:72px;height:26px;border-radius:8px;border:1px solid var(--hair);
  background:#f1f5f9;display:flex;align-items:center;justify-content:center;font-weight:700;text-decoration:none;}

.divider{height:8px;background:var(--bg);border-top:1px dashed var(--hair);}

/* dynamic font scaling for Serie view */
.game-top.dynamic-scale .game-time,
.game-top.dynamic-scale .game-series a,
.game-top.dynamic-scale .game-mid{font-size:var(--dyn-font,14px);}
</style>
</head>

<body>
<div class="device">

<header class="topbar">
  <div class="topbar-inner">
    <div class="cluster-left">
      <button class="icon-btn">üè†</button>
      <button class="icon-btn">üó∫Ô∏è</button>
    </div>
    <div class="cluster-center">
      <button class="icon-btn">‚óÄ</button>
      <div class="date-block"><span>Idag</span><span>Tors</span><span>23 okt</span></div>
      <button class="icon-btn">‚ñ∂</button>
    </div>
    <div class="cluster-right">
      <div class="sort-stack">
        <div class="sort-top">Sortering</div>
        <div class="sort-bottom">
          <span id="pillPlace"  class="pill on">Plats</span>
          <span id="pillSeries" class="pill off">Serie</span>
          <span id="pillTime"   class="pill on lock">Tid</span>
        </div>
      </div>
      <button class="icon-btn">‚öôÔ∏è</button>
    </div>
  </div>
</header>

<div class="hint">Visar matcher n√§ra: Kruniusv√§gen 1, Billdal</div>

<div id="groupSlot" class="group-slot">
  <div class="group-title">Kungsbacka Ishall A</div>
  <div class="group-sub">Avst 8 km</div>
</div>

<main id="scrollArea" class="scroll"></main>

</div>

<script>
/* -------- LOGOS -------- */
const LOGOS = {
  backen:  "logos/B√§cken_HC__119055af-fc61-4108-82a8-a0cd0e883df0.png",
  grastorp:"logos/Gr√§storps_IK__c6811c5f-e2c9-43e2-a9c2-73ab53f63fd1.png",
  hanhals: "logos/Hanhals_IF__b65395a8-4623-46e4-96ab-97ff2e0e7b72.png",
  kungalv: "logos/Kung√§lvs_IK__620a9df2-1b0b-4bc5-b9eb-7e88670f4c7b.png",
};

/* -------- DATA -------- */
const ARENAS = {
  "Kungsbacka Ishall A": 8,
  "√Öse & Viste Arena": 104
};

/* 5 + 10 matcher */
const GAMES = [
  { arena:"Kungsbacka Ishall A", time:"09:00", series:"HockeyTv√•an S√∂dra", home:{name:"Hanhals IF",logo:LOGOS.hanhals}, away:{name:"B√§cken HC",logo:LOGOS.backen}, result:"‚Äì" },
  { arena:"Kungsbacka Ishall A", time:"09:40", series:"J18 Region S√∂dra", home:{name:"Kung√§lvs IK",logo:LOGOS.kungalv}, away:{name:"Gr√§storps IK",logo:LOGOS.grastorp}, result:"3 - 2" },
  { arena:"Kungsbacka Ishall A", time:"10:20", series:"J20 Region Syd", home:{name:"B√§cken HC U20",logo:LOGOS.backen}, away:{name:"IF M√∂lndal Hockey",logo:LOGOS.hanhals}, result:"‚Äì" },
  { arena:"Kungsbacka Ishall A", time:"11:00", series:"Tr√§ningsmatch", home:{name:"Gr√§storps IK J18",logo:LOGOS.grastorp}, away:{name:"Kung√§lvs IK J18",logo:LOGOS.kungalv}, result:"2 - 4" },
  { arena:"Kungsbacka Ishall A", time:"11:40", series:"HockeyTv√•an V√§stra", home:{name:"Hisingen Hockey",logo:LOGOS.hanhals}, away:{name:"Partille HK",logo:LOGOS.backen}, result:"‚Äì" },

  { arena:"√Öse & Viste Arena", time:"09:20", series:"HockeyTv√•an S√∂dra", home:{name:"Gr√§storps IK",logo:LOGOS.grastorp}, away:{name:"Kung√§lvs IK",logo:LOGOS.kungalv}, result:"‚Äì" },
  { arena:"√Öse & Viste Arena", time:"10:00", series:"J20 Region Syd", home:{name:"Hanhals IF",logo:LOGOS.hanhals}, away:{name:"B√§cken HC",logo:LOGOS.backen}, result:"2 - 2" },
  { arena:"√Öse & Viste Arena", time:"10:40", series:"J18 Region S√∂dra", home:{name:"Kung√§lvs IK J18",logo:LOGOS.kungalv}, away:{name:"Gr√§storps IK J18",logo:LOGOS.grastorp}, result:"‚Äì" },
  { arena:"√Öse & Viste Arena", time:"11:20", series:"HockeyTv√•an V√§stra", home:{name:"B√§cken HC",logo:LOGOS.backen}, away:{name:"Nybro Vikings IF",logo:LOGOS.backen}, result:"‚Äì" },
  { arena:"√Öse & Viste Arena", time:"12:00", series:"Tr√§ningsmatch", home:{name:"Gr√§storps IK",logo:LOGOS.grastorp}, away:{name:"Hisingen Hockey",logo:LOGOS.hanhals}, result:"4 - 1" },
  { arena:"√Öse & Viste Arena", time:"12:40", series:"J20 Region Syd", home:{name:"Hanhals IF U20",logo:LOGOS.hanhals}, away:{name:"IF M√∂lndal Hockey",logo:LOGOS.hanhals}, result:"‚Äì" },
  { arena:"√Öse & Viste Arena", time:"13:20", series:"HockeyTv√•an S√∂dra", home:{name:"Kung√§lvs IK",logo:LOGOS.kungalv}, away:{name:"Troja-Ljungby",logo:LOGOS.hanhals}, result:"‚Äì" },
  { arena:"√Öse & Viste Arena", time:"14:00", series:"J18 Region S√∂dra", home:{name:"B√§cken HC J18",logo:LOGOS.backen}, away:{name:"Kalmar HC",logo:LOGOS.backen}, result:"3 - 0" },
  { arena:"√Öse & Viste Arena", time:"14:40", series:"HockeyTv√•an V√§stra", home:{name:"Gr√§storps IK",logo:LOGOS.grastorp}, away:{name:"Partille HK",logo:LOGOS.backen}, result:"‚Äì" },
  { arena:"√Öse & Viste Arena", time:"15:20", series:"Tr√§ningsmatch", home:{name:"IF M√∂lndal Hockey",logo:LOGOS.hanhals}, away:{name:"K√•llereds SK",logo:LOGOS.hanhals}, result:"‚Äì" }
];

const MODE = { PLACE:"place", SERIES:"series", SERIES_TIME:"series_time" };
let mode = MODE.PLACE;

const slot = document.getElementById("groupSlot");
const scroll = document.getElementById("scrollArea");
const pillPlace = document.getElementById("pillPlace");
const pillSeries = document.getElementById("pillSeries");
const pillTime = document.getElementById("pillTime");

/* -------- helpers -------- */
function km(a){ return ARENAS[a] ?? 0; }
function parseTime(t){ const [h,m]=t.split(":").map(Number); return h*60+m; }
function seriesPriority(name){
  const n=name.toLowerCase();
  if(n.includes("hockeytv√•an"))return 10;
  if(n.includes("j20")||n.includes("u20"))return 15;
  if(n.includes("j18")||n.includes("u18"))return 16;
  if(n.includes("tr√§nings"))return 99;
  return 50;
}

/* -------- card builder -------- */
function gameCard(g, seriesMode){
  const a=document.createElement("article");a.className="game";
  const top=document.createElement("div");
  top.className=seriesMode?"game-top dynamic-scale":"game-top";

  const t=document.createElement("div");t.className="game-time";t.textContent=g.time;
  const s=document.createElement("div");s.className="game-series";
  s.innerHTML=`<a href="#">${g.series}</a>`;
  top.appendChild(t);top.appendChild(s);

  if(seriesMode){
    const mid=document.createElement("div");mid.className="game-mid";mid.textContent=g.arena;
    const right=document.createElement("div");right.className="game-right";right.textContent=`Avst ${km(g.arena)} km`;
    top.appendChild(mid);top.appendChild(right);
  }

  const bottom=document.createElement("div");
  bottom.className="game-bottom";
  bottom.innerHTML=`
    <div class="team"><img class="team-logo" src="${g.home.logo}"><span class="team-name">${g.home.name}</span></div>
    <div class="result"><a href="#">${g.result}</a></div>
    <div class="team right"><img class="team-logo" src="${g.away.logo}"><span class="team-name">${g.away.name}</span></div>`;
  a.appendChild(top);a.appendChild(bottom);
  return a;
}

/* -------- sticky arena detection -------- */
function updateStickyFromHeaders(){
  const headers=Array.from(scroll.querySelectorAll(".arena-header"));
  if(!headers.length)return;
  const viewportTop=scroll.getBoundingClientRect().top+1;
  let current=headers[0];
  for(const h of headers){
    const r=h.getBoundingClientRect();
    if(r.top <= viewportTop) current=h; else break;
  }
  document.querySelector(".group-title").textContent=current.dataset.arenaHeader;
  document.querySelector(".group-sub").textContent=`Avst ${km(current.dataset.arenaHeader)} km`;
}

/* -------- dynamic scaling -------- */
function autoScaleTopRows(){
  if(mode===MODE.PLACE)return;
  const rows=scroll.querySelectorAll(".game-top.dynamic-scale");
  rows.forEach(row=>{
    let font=14;
    row.style.setProperty("--dyn-font",font+"px");
    while(row.scrollWidth>row.clientWidth && font>11){
      font--;
      row.style.setProperty("--dyn-font",font+"px");
    }
  });
}

/* -------- render -------- */
function render(){
  scroll.innerHTML="";

  if(mode===MODE.PLACE){
    slot.style.display="flex";

    const byArena={};for(const g of GAMES)(byArena[g.arena]??=[]).push(g);
    const arenas=Object.keys(byArena).sort((a,b)=>km(a)-km(b));

    document.querySelector(".group-title").textContent=arenas[0];
    document.querySelector(".group-sub").textContent=`Avst ${km(arenas[0])} km`;

    for(const a of arenas){
      const h=document.createElement("div");
      h.className="arena-header";
      h.dataset.arenaHeader=a;
      h.innerHTML=`<div>${a}</div><div>Avst ${km(a)} km</div>`;
      scroll.appendChild(h);

      const games=byArena[a].slice().sort((x,y)=>parseTime(x.time)-parseTime(y.time));
      games.forEach(g=>scroll.appendChild(gameCard(g,false)));
    }

    scroll.addEventListener("scroll",updateStickyFromHeaders,{passive:true});
    updateStickyFromHeaders();
  }
  else{
    slot.style.display="none";
    scroll.removeEventListener("scroll",updateStickyFromHeaders);

    const bySeries={};
    for(const g of GAMES)(bySeries[g.series]??=[]).push(g);
    const keys=Object.keys(bySeries).sort((a,b)=>seriesPriority(a)-seriesPriority(b));

    let first=true;
    for(const s of keys){
      const list=bySeries[s].slice();
      if(mode===MODE.SERIES_TIME)
        list.sort((a,b)=>parseTime(a.time)-parseTime(b.time));
      else
        list.sort((a,b)=>seriesPriority(a.series)-seriesPriority(b.series)||parseTime(a.time)-parseTime(b.time));

      if(mode===MODE.SERIES && !first){
        const d=document.createElement("div");d.className="divider";scroll.appendChild(d);
      }
      first=false;

      list.forEach(g=>scroll.appendChild(gameCard(g,true)));
    }
  }

  autoScaleTopRows();
}

/* -------- pill control -------- */
function applyPills(){
  pillPlace.className = mode===MODE.PLACE      ? "pill on"          : "pill off";
  pillSeries.className = mode!==MODE.PLACE     ? "pill on"          : "pill off";
  pillTime.className   = mode===MODE.PLACE     ? "pill on lock"     : (mode===MODE.SERIES_TIME?"pill on":"pill off");
}

function setMode(m){
  mode=m;
  applyPills();
  render();
}

/* -------- actions -------- */
pillPlace.onclick = ()=>setMode(MODE.PLACE);
pillSeries.onclick = ()=>{ if(mode!==MODE.PLACE) setMode(MODE.SERIES); };
pillTime.onclick = ()=>{
  if(mode===MODE.PLACE) return;
  setMode(mode===MODE.SERIES ? MODE.SERIES_TIME : MODE.SERIES);
};

/* init */
applyPills();
render();
</script>
</body>
</html>

