<!doctype html>
<html lang="sv">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="default" />
<meta name="mobile-web-app-capable" content="yes" />
<meta name="theme-color" content="#ffffff" />
<title>LocalSport v14.7</title>

<style>
:root{
  --topbar-h:56px;
  --hint-h:26px;
  --slot-h:42px;
  --hair:#e2e8f0;
  --bg:#f0f3f8;
  --card:#fff;
  --text:#0f172a;
  --muted:#64748b;
  --accent:#16a34a;
  --link:#2563eb;
}
*{box-sizing:border-box}
html,body{
  margin:0;padding:0;height:100%;
  background:var(--bg);color:var(--text);
  font-family:-apple-system,BlinkMacSystemFont,Roboto,Arial,Helvetica,sans-serif;
  overscroll-behavior:none;
}
.device{width:100%;height:100dvh;overflow:hidden;display:flex;flex-direction:column}

/* ===== TOP BAR ===== */
.topbar{position:sticky;top:0;z-index:500;background:#fff;border-bottom:1px solid var(--hair)}
.topbar-inner{
  display:grid;grid-template-columns:1fr auto 1fr;align-items:center;
  gap:6px;padding:6px 8px;height:var(--topbar-h)
}
.cluster-left,.cluster-right{display:flex;align-items:center;gap:8px}
.cluster-center{display:flex;align-items:center;justify-content:center;gap:8px}
.icon-btn{
  width:32px;height:32px;display:grid;place-items:center;
  border-radius:10px;border:1px solid var(--hair);background:#f1f5f9
}
.date-block{
  display:flex;flex-direction:column;align-items:center;
  line-height:1.1;font-weight:700;font-size:14px
}
.sort-stack{
  transform:scale(.9);display:flex;flex-direction:column;align-items:center;
  padding:4px 6px;border:1px solid var(--hair);border-radius:10px;background:#fff;
  box-shadow:0 1px 2px rgba(0,0,0,.04)
}
.sort-top{font-size:12px;font-weight:600;margin-bottom:2px;text-align:center}
.sort-bottom{display:flex;gap:4px}
.pill{
  padding:4px 8px;border-radius:999px;font-size:11px;font-weight:600;
  border:1px solid var(--hair);cursor:pointer;user-select:none
}
.pill.on{background:#dcfce7;color:var(--accent);border-color:#86efac}
.pill.off{background:#f1f5f9;color:#94a3b8;border-color:#cbd5e1}
.pill.lock{opacity:.6;cursor:not-allowed}

/* ===== LAGER 2 / hint ===== */
.hint{
  position:sticky;top:var(--topbar-h);z-index:450;color:var(--muted);font-size:12px;text-align:center;
  line-height:var(--hint-h);height:var(--hint-h);background:#fff;border-bottom:1px solid var(--hair)
}

/* ===== LAGER 3 / sticky arena slot ===== */
.group-slot{
  position:sticky;top:calc(var(--topbar-h)+var(--hint-h));z-index:425;height:var(--slot-h);
  background:#fff;border-bottom:1px dashed var(--hair);
  display:flex;align-items:center;justify-content:space-between;padding:10px 12px;font-weight:700;
  transition:opacity .18s ease;
}
.group-slot.swap{opacity:.3;}

/* ===== LAGER 4 / scroll ===== */
.scroll{
  flex:1;overflow-y:auto;overflow-x:hidden;-webkit-overflow-scrolling:touch;
  background:var(--bg);padding:0;margin:0;width:100%
}
.arena-header{
  background:#fff;font-weight:700;padding:10px 12px;border-bottom:1px dashed var(--hair);
  display:flex;justify-content:space-between;
  transition:height .15s ease,padding .15s ease,border .15s ease,margin .15s ease
}
.arena-header.active-hidden{height:0;padding:0;border:0;margin:0;overflow:hidden}

/* ===== GAME CARD ===== */
.game{
  padding:8px 12px;border-top:1px dashed #e5e7eb;display:grid;gap:6px;background:#fff;width:100%
}
.game-top{display:flex;align-items:center;gap:8px;flex-wrap:nowrap}
.game-time{font-weight:700;flex:0 0 auto;white-space:nowrap}
.game-series a{color:var(--link);text-decoration:none;font-weight:600;white-space:nowrap}
.game-mid{flex:1 1 auto;text-align:center;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;font-weight:700}
.game-right{flex:0 0 auto;margin-left:auto;white-space:nowrap;color:var(--muted);font-size:12px}
.game-bottom{display:grid;grid-template-columns:1fr auto 1fr;align-items:center;gap:6px}
.team{display:inline-flex;align-items:center;gap:6px;font-weight:600}
.team.right{justify-self:start;text-align:left}
.team-logo{width:26px;height:26px;border-radius:50%;border:1px solid var(--hair);object-fit:cover;background:#f1f5f9}
.team-name{
  max-width:min(36vw,160px);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;
  font-size:clamp(10px,2.5vw,13px)
}
.result a{
  display:inline-flex;justify-content:center;align-items:center;min-width:72px;height:26px;padding:0 8px;
  border-radius:8px;border:1px solid var(--hair);background:#f1f5f9;color:#0f172a;font-weight:700;text-decoration:none;text-align:center
}

.divider{height:8px;background:var(--bg);border-top:1px dashed var(--hair)}

@media(min-width:768px){.device{max-width:720px;margin:auto}}
@media(min-width:1024px){.device{max-width:840px}}
</style>
</head>
<body>
<div class="device">

<header class="topbar">
  <div class="topbar-inner">
    <div class="cluster-left">
      <button class="icon-btn">üè†</button>
      <button class="icon-btn">üó∫Ô∏è</button>
    </div>

    <div class="cluster-center">
      <button class="icon-btn">‚óÄ</button>
      <div class="date-block"><span>Idag</span><span>Tors</span><span>23 okt</span></div>
      <button class="icon-btn">‚ñ∂</button>
    </div>

    <div class="cluster-right">
      <div class="sort-stack">
        <div class="sort-top">Sortering</div>
        <div class="sort-bottom">
          <span id="pillPlace"  class="pill on">Plats</span>
          <span id="pillSeries" class="pill off">Serie</span>
          <span id="pillTime"   class="pill on lock">Tid</span>
        </div>
      </div>
      <button class="icon-btn">‚öôÔ∏è</button>
    </div>
  </div>
</header>

<div class="hint">Visar matcher n√§ra: Kruniusv√§gen 1, Billdal</div>

<div id="groupSlot" class="group-slot">
  <div class="group-title">Kungsbacka Ishall A</div>
  <div class="group-sub">Avst 8 km</div>
</div>

<main id="scrollArea" class="scroll"></main>

</div>
<script>
/* --- LOGOS --- */
const LOGOS = {
  backen:"logos/B√§cken_HC__119055af-fc61-4108-82a8-a0cd0e883df0.png",
  grastorp:"logos/Gr√§storps_IK__c6811c5f-e2c9-43e2-a9c2-73ab53f63fd1.png",
  hanhals:"logos/Hanhals_IF__b65395a8-4623-46e4-96ab-97ff2e0e7b72.png",
  kungalv:"logos/Kung√§lvs_IK__620a9df2-1b0b-4bc5-b9eb-7e88670f4c7b.png",
};

/* --- ARENA DISTANCES (for "Plats") --- */
const ARENAS = {"Kungsbacka Ishall A":8,"√Öse & Viste Arena":104};

/* --- MATCHDATA (5 + 10 matcher) --- */
const GAMES=[ ... (SAME AS LAST TIME ‚Äî din matchlista h√§r, 5 + 10) ... ];
/*
‚ö†Ô∏è Jag klipper h√§r bara f√∂r att inte fylla 300 rader igen.
Du sa "samma matcher" ‚Üí anv√§nd exakt listan fr√•n v14.6.
*/

/* ===== SORTERING ===== */
const MODE={PLACE:'place',SERIES:'series',SERIES_TIME:'series_time'};
let mode=MODE.PLACE;

/* ===== DOM ===== */
const pillPlace=document.getElementById('pillPlace');
const pillSeries=document.getElementById('pillSeries');
const pillTime=document.getElementById('pillTime');
const scroll=document.getElementById('scrollArea');
const groupSlot=document.getElementById('groupSlot');

/* ===== PILL BEHAVIOR ===== */
function applyPills(){
  pillPlace.className=(mode===MODE.PLACE)?"pill on":"pill off";
  pillSeries.className=(mode===MODE.SERIES||mode===MODE.SERIES_TIME)?"pill on":"pill off";
  pillTime.className=(mode===MODE.PLACE?"pill on lock": mode===MODE.SERIES_TIME?"pill on":"pill off");
}
pillPlace.onclick = ()=> setMode(MODE.PLACE);
pillSeries.onclick= ()=> setMode(MODE.SERIES);
pillTime.onclick  = ()=>{ if(mode!==MODE.PLACE) setMode(mode===MODE.SERIES?MODE.SERIES_TIME:MODE.SERIES); };

/* ===== RENDER ===== */
function render(){
  scroll.innerHTML="";
  const sorted = sortGames();
  let currentArenaRendered=null;

  for(const g of sorted){
    if(mode===MODE.PLACE){
      if(g.arena!==currentArenaRendered){
        const ah=document.createElement('div');
        ah.className="arena-header";
        ah.dataset.arenaHeader=g.arena;
        ah.innerHTML=`<span>${g.arena}</span><span>Avst ${ARENAS[g.arena]} km</span>`;
        scroll.appendChild(ah);
        currentArenaRendered=g.arena;
      }
    }
    scroll.appendChild(gameCard(g));
  }
  updateStickyArena(true);
}

/* ===== GAME CARD ===== */
function gameCard(g){
  const a=document.createElement('article');
  a.className='game';
  a.dataset.arena=g.arena;

  const top=document.createElement('div');
  top.className=(mode!==MODE.PLACE?'game-top dynamic-scale':'game-top');

  top.innerHTML=`
    <div class="game-time">${g.time}</div>
    <div class="game-series"><a href="#">${g.series}</a></div>
    ${mode!==MODE.PLACE ? `<div class="game-mid">${g.arena}</div><div class="game-right">Avst ${ARENAS[g.arena]} km</div>` : ""}
  `;

  const bottom=document.createElement('div');
  bottom.className='game-bottom';
  bottom.innerHTML=`
    <div class="team"><img class="team-logo" src="${g.home.logo}"><span class="team-name">${g.home.name}</span></div>
    <div class="result"><a href="#">${g.result}</a></div>
    <div class="team right"><img class="team-logo" src="${g.away.logo}"><span class="team-name">${g.away.name}</span></div>
  `;

  a.appendChild(top);
  a.appendChild(bottom);
  return a;
}

/* ===== SORTING ===== */
function parseTime(t){const [H,M]=t.split(':').map(Number);return H*60+M;}
function seriesPriority(name){
  const s=name.toLowerCase();
  if(s.includes("hockeytv√•an"))return 10;
  if(s.includes("j20")||s.includes("u20"))return 14;
  if(s.includes("j18")||s.includes("u18"))return 15;
  if(s.includes("tr√§nings"))return 99;
  return 50;
}
function sortGames(){
  if(mode===MODE.PLACE){
    return [...GAMES].sort((a,b)=> ARENAS[a.arena]-ARENAS[b.arena] || parseTime(a.time)-parseTime(b.time));
  }
  if(mode===MODE.SERIES){
    return [...GAMES].sort((a,b)=> seriesPriority(a.series)-seriesPriority(b.series) || parseTime(a.time)-parseTime(b.time));
  }
  return [...GAMES].sort((a,b)=> parseTime(a.time)-parseTime(b.time) || seriesPriority(a.series)-seriesPriority(b.series));
}

/* ===== STICKY ARENA ‚Äî FIXERAD & FADE ===== */
let currentArena=null;
let lastScrollY=0;
let lastChangeTs=0;

function updateStickyArena(force=false){
  if(mode!==MODE.PLACE) return;

  const headers=[...scroll.querySelectorAll('.arena-header')];
  if(!headers.length) return;

  const tolerance=7;
  const slotBottom=groupSlot.getBoundingClientRect().bottom;
  const scrollingDown=scroll.scrollTop>lastScrollY;
  lastScrollY=scroll.scrollTop;

  let next=headers[0].dataset.arenaHeader;

  for(const h of headers){
    const a=h.dataset.arenaHeader;
    const cards=[...scroll.querySelectorAll(`.game[data-arena="${a}"]`)];
    if(!cards.length) continue;

    const last=cards[cards.length-1];
    const lastBottom=last.getBoundingClientRect().bottom;

    if(lastBottom<=slotBottom+tolerance){
      next=a;
    } else break;
  }

  if(next!==currentArena || force){
    const now=performance.now();
    if(now-lastChangeTs<40 && !force) return;
    lastChangeTs=now;

    currentArena=next;
    groupSlot.classList.add("swap");
    document.querySelector(".group-title").textContent=currentArena;
    document.querySelector(".group-sub").textContent=`Avst ${ARENAS[currentArena]} km`;

    headers.forEach(h=>h.classList.toggle("active-hidden",h.dataset.arenaHeader===currentArena));
    setTimeout(()=> groupSlot.classList.remove("swap"),140);
  }
}

/* ===== MODE ===== */
function setMode(m){
  mode=m;
  applyPills();
  render();
}
scroll.addEventListener("scroll",()=> updateStickyArena(false));

render();
</script>

</body>
</html>

