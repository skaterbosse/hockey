<!doctype html>
<html lang="sv">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="default" />
<meta name="mobile-web-app-capable" content="yes" />
<meta name="theme-color" content="#ffffff" />
<title>LocalSport v11 ‚Äì Sorting Toggle (5+10 spel)</title>
<style>
:root{
  --topbar-h:56px;
  --hint-h:26px;
  --slot-h:42px;
  --hair:#e2e8f0;
  --bg:#f0f3f8;
  --card:#fff;
  --text:#0f172a;
  --muted:#64748b;
  --accent:#16a34a;
  --link:#2563eb;
}
*{box-sizing:border-box}
html,body{margin:0;padding:0;height:100%;background:var(--bg);color:var(--text);
  font-family:-apple-system,BlinkMacSystemFont,Roboto,Arial,Helvetica,sans-serif;overscroll-behavior:none}
.device{width:100%;height:100dvh;margin:0 auto;overflow:hidden;display:flex;flex-direction:column}

/* LAYER 1: topbar */
.topbar{position:sticky;top:0;z-index:500;background:#fff;border-bottom:1px solid var(--hair)}
.topbar-inner{display:grid;grid-template-columns:1fr auto 1fr;align-items:center;gap:6px;padding:6px 8px;height:var(--topbar-h)}
.cluster-left,.cluster-right{display:flex;align-items:center;gap:8px}
.cluster-center{display:flex;align-items:center;justify-content:center;gap:8px}
.icon-btn{width:32px;height:32px;display:grid;place-items:center;border-radius:10px;border:1px solid var(--hair);background:#f1f5f9}
.date-block{display:flex;flex-direction:column;align-items:center;line-height:1.1;font-weight:700;font-size:14px}
.sort-stack{transform:scale(.9);display:flex;flex-direction:column;align-items:center;padding:4px 6px;border:1px solid var(--hair);border-radius:10px;background:#fff;box-shadow:0 1px 2px rgba(0,0,0,.04)}
.sort-top{font-size:12px;font-weight:600;margin-bottom:2px;text-align:center}
.sort-bottom{display:flex;gap:4px}
.pill{padding:4px 8px;border-radius:999px;font-size:11px;font-weight:600;border:1px solid var(--hair);cursor:pointer;user-select:none}
.pill.on{background:#dcfce7;color:var(--accent);border-color:#86efac}
.pill.off{background:#f1f5f9;color:#94a3b8;border-color:#cbd5e1}
.pill.lock{opacity:.6;cursor:not-allowed}

/* LAYER 2: hint */
.hint{position:sticky;top:var(--topbar-h);z-index:450;color:var(--muted);font-size:12px;text-align:center;
  line-height:var(--hint-h);height:var(--hint-h);background:#fff;border-bottom:1px solid var(--hair)}

/* LAYER 3: grouping slot (arena or series) */
.group-slot{position:sticky;top:calc(var(--topbar-h)+var(--hint-h));z-index:425;height:var(--slot-h);
  background:#fff;border-bottom:1px dashed var(--hair);display:flex;align-items:center;justify-content:space-between;padding:10px 12px}
.group-title{font-weight:700}
.group-sub{font-size:12px;color:var(--muted)}

/* LAYER 4: scroll area full width */
.scroll{flex:1;overflow-y:auto;-webkit-overflow-scrolling:touch;background:var(--bg);padding:0;margin:0;width:100%}

/* Sections (groups) */
.group{margin:0 0 10px 0;width:100%;border:1px solid var(--hair);border-radius:0 0 14px 14px;background:var(--card);
  box-shadow:0 2px 6px rgba(0,0,0,.05);overflow:hidden}
.group.active .group-header{display:none} /* hide duplicate header inside scroller for current group */
.group-header{height:var(--slot-h);display:flex;align-items:center;justify-content:space-between;padding:10px 12px;border-bottom:1px dashed var(--hair);background:#fff}
.group-h-title{font-weight:700}
.group-h-sub{font-size:12px;color:var(--muted)}
.games{display:block}

/* Game cards */
.game{padding:8px 12px;border-top:1px dashed #e5e7eb;display:grid;gap:6px;background:#fff;width:100%}
.game-top{display:flex;align-items:center;gap:12px;font-weight:600;justify-content:space-between}
.game-left{display:flex;align-items:center;gap:12px} /* time + series */
.game-mid{margin-left:auto;margin-right:12px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:40vw;text-align:center}
.game-right{margin-left:auto;white-space:nowrap;color:var(--muted);font-size:12px}
.game-time{font-weight:700}
.game-series a{color:var(--link);text-decoration:none;font-weight:600}
.game-bottom{display:grid;grid-template-columns:1fr auto 1fr;align-items:center;gap:6px}
.team{display:inline-flex;align-items:center;gap:6px;font-weight:600}
.team.right{justify-self:start;text-align:left}
.team-logo{width:26px;height:26px;border-radius:50%;border:1px solid var(--hair);object-fit:cover;background:#f1f5f9}
.team-name{max-width:min(36vw,160px);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;font-size:clamp(10px,2.5vw,13px)}
.result a{display:inline-flex;justify-content:center;align-items:center;min-width:72px;height:26px;padding:0 8px;border-radius:8px;border:1px solid var(--hair);background:#f1f5f9;color:var(--text);font-weight:700;text-decoration:none;text-align:center}

@media(min-width:768px){.device{max-width:720px;margin:auto}}
@media(min-width:1024px){.device{max-width:840px}}
</style>
</head>
<body>
<div class="device">

  <!-- Layer 1 -->
  <header class="topbar">
    <div class="topbar-inner">
      <div class="cluster-left">
        <button class="icon-btn" aria-label="Hem">üè†</button>
        <button class="icon-btn" aria-label="Karta">üó∫Ô∏è</button>
      </div>
      <div class="cluster-center">
        <button class="icon-btn" aria-label="F√∂reg√•ende dag">‚óÄ</button>
        <div class="date-block"><span>Idag</span><span>Tors</span><span>23 okt</span></div>
        <button class="icon-btn" aria-label="N√§sta dag">‚ñ∂</button>
      </div>
      <div class="cluster-right">
        <div class="sort-stack">
          <div class="sort-top">Sortering</div>
          <div class="sort-bottom">
            <span id="pillPlace" class="pill on">Plats</span>
            <span id="pillSeries" class="pill off">Serie</span>
            <span id="pillTime" class="pill off">Tid</span>
          </div>
        </div>
        <button class="icon-btn" aria-label="Inst√§llningar">‚öôÔ∏è</button>
      </div>
    </div>
  </header>

  <!-- Layer 2 -->
  <div class="hint">Visar matcher n√§ra: Kruniusv√§gen 1, Billdal (57.590214, 11.946082)</div>

  <!-- Layer 3 -->
  <div id="groupSlot" class="group-slot">
    <div class="group-title">Kungsbacka Ishall A</div>
    <div class="group-sub">Avst 8 km</div>
  </div>

  <!-- Layer 4 -->
  <main id="scrollArea" class="scroll">
    <!-- groups will be rendered here -->
  </main>

</div>

<script>
/* ---------- DATA (5 + 10 games) ---------- */
const ARENAS = {
  "Kungsbacka Ishall A": { distanceKm: 8 },
  "√Öse & Viste Arena":   { distanceKm: 104 }
};
const LOGOS = {
  hanhals: "logos/Hanhals_IF__b65395a8-4623-46e4-96ab-97ff2e0e7b72.png",
  backen:  "logos/B√§cken_HC__119055af-fc61-4108-82a8-a0cd0e883df0.png",
  kungalv: "logos/Kung√§lvs_IK__620a9df2-1b0b-4bc5-b9eb-7e88670f4c7b.png",
  grastorp:"logos/Gr√§storps_IK__c6811c5f-e2c9-43e2-a9c2-73ab53f63fd1.png"
};
/* Helper for a team record */
const T = (name, logo) => ({ name, logo });

/* Games: first 5 (Kungsbacka), first 10 (√Öse & Viste) ‚Äî times preserved from previous versions */
const GAMES = [
  /* ===== Kungsbacka Ishall A (5) ===== */
  { arena:"Kungsbacka Ishall A", series:"HockeyTv√•an S√∂dra", time:"09:00",
    home:T("Hanhals IF", LOGOS.hanhals), away:T("B√§cken HC", LOGOS.backen), result:"‚Äì" },
  { arena:"Kungsbacka Ishall A", series:"J18 Region S√∂dra", time:"09:40",
    home:T("Kung√§lvs IK", LOGOS.kungalv), away:T("Gr√§storps IK", LOGOS.grastorp), result:"3 - 2" },
  { arena:"Kungsbacka Ishall A", series:"J20 Region Syd", time:"10:20",
    home:T("B√§cken HC U20", LOGOS.backen), away:T("IF M√∂lndal Hockey", LOGOS.hanhals), result:"‚Äì" },
  { arena:"Kungsbacka Ishall A", series:"Tr√§ningsmatch", time:"11:00",
    home:T("Gr√§storps IK J18", LOGOS.grastorp), away:T("Kung√§lvs IK J18", LOGOS.kungalv), result:"2 - 4" },
  { arena:"Kungsbacka Ishall A", series:"HockeyTv√•an V√§stra", time:"11:40",
    home:T("Hisingen Hockey", LOGOS.hanhals), away:T("Partille HK", LOGOS.backen), result:"‚Äì" },

  /* ===== √Öse & Viste Arena (10) ===== */
  { arena:"√Öse & Viste Arena", series:"HockeyTv√•an S√∂dra", time:"09:20",
    home:T("Gr√§storps IK", LOGOS.grastorp), away:T("Kung√§lvs IK", LOGOS.kungalv), result:"‚Äì" },
  { arena:"√Öse & Viste Arena", series:"J20 Region Syd", time:"10:00",
    home:T("Hanhals IF", LOGOS.hanhals), away:T("B√§cken HC", LOGOS.backen), result:"2 - 2" },
  { arena:"√Öse & Viste Arena", series:"J18 Region S√∂dra", time:"10:40",
    home:T("Kung√§lvs IK J18", LOGOS.kungalv), away:T("Gr√§storps IK J18", LOGOS.grastorp), result:"‚Äì" },
  { arena:"√Öse & Viste Arena", series:"HockeyTv√•an V√§stra", time:"11:20",
    home:T("B√§cken HC", LOGOS.backen), away:T("Nybro Vikings IF", LOGOS.backen), result:"‚Äì" },
  { arena:"√Öse & Viste Arena", series:"Tr√§ningsmatch", time:"12:00",
    home:T("Gr√§storps IK", LOGOS.grastorp), away:T("Hisingen Hockey", LOGOS.hanhals), result:"4 - 1" },
  { arena:"√Öse & Viste Arena", series:"J20 Region Syd", time:"12:40",
    home:T("Hanhals IF U20", LOGOS.hanhals), away:T("IF M√∂lndal Hockey", LOGOS.hanhals), result:"‚Äì" },
  { arena:"√Öse & Viste Arena", series:"HockeyTv√•an S√∂dra", time:"13:20",
    home:T("Kung√§lvs IK", LOGOS.kungalv), away:T("Troja-Ljungby", LOGOS.hanhals), result:"‚Äì" },
  { arena:"√Öse & Viste Arena", series:"J18 Region S√∂dra", time:"14:00",
    home:T("B√§cken HC J18", LOGOS.backen), away:T("Kalmar HC", LOGOS.backen), result:"3 - 0" },
  { arena:"√Öse & Viste Arena", series:"HockeyTv√•an V√§stra", time:"14:40",
    home:T("Gr√§storps IK", LOGOS.grastorp), away:T("Partille HK", LOGOS.backen), result:"‚Äì" },
  { arena:"√Öse & Viste Arena", series:"Tr√§ningsmatch", time:"15:20",
    home:T("IF M√∂lndal Hockey", LOGOS.hanhals), away:T("K√•llereds SK", LOGOS.hanhals), result:"‚Äì" },
];

/* ---------- Series priority (approximation per your rules) ---------- */
/* Categories: 1) Federation top (SHL, HA, SDHL, HockeyEttan) ‚Äì not present here
   2) Regions top: HockeyTv√•an, NDHL, HockeyTrean, DamTv√•an, U20 Regional, HockeyFyran
   3) U-series: prefer higher U first (U20 > U18)
   4) Rest ‚Üí Tr√§ningsmatch lowest
*/
function seriesPriority(name){
  const n = name.toLowerCase();
  if (n.includes("hockeytv√•an")) return 10;
  if (n.includes("ndhl")) return 11;
  if (n.includes("hockeytrean")) return 12;
  if (n.includes("damtv√•an")) return 13;
  if (n.includes("u20")) return 14; // U20 regional high
  if (n.includes("u18") || n.includes("j18")) return 15;
  if (n.includes("u16")) return 16;
  if (n.includes("hockeyfyran")) return 17;
  if (n.includes("tr√§ningsmatch")) return 99; // lowest
  return 50; // generic
}

/* ---------- Utilities ---------- */
function parseTime(t){ const [H,M]=t.split(":").map(Number); return H*60+M; }
function km(arena){ return ARENAS[arena]?.distanceKm ?? 0; }

/* ---------- Sorting modes ---------- */
const MODE = { PLACE: 'place', SERIES: 'series', SERIES_TIME: 'series_time' };

/* ---------- Render engine ---------- */
const scroll = document.getElementById('scrollArea');
const slot   = document.getElementById('groupSlot');
const pillPlace  = document.getElementById('pillPlace');
const pillSeries = document.getElementById('pillSeries');
const pillTime   = document.getElementById('pillTime');

let currentMode = MODE.PLACE; // default
applyPillState();

/* Build groups according to current mode and render DOM */
function render(){
  scroll.innerHTML = "";

  let groups = [];
  if (currentMode === MODE.PLACE){
    // group by arena
    const byArena = {};
    for (const g of GAMES){ (byArena[g.arena] ||= []).push(g); }
    const entries = Object.entries(byArena)
      .map(([arena, games]) => ({ key: arena, sub:`Avst ${km(arena)} km`, games }));
    // sort groups by distance
    entries.sort((a,b)=> km(a.key)-km(b.key));
    // sort games by time
    for (const e of entries){ e.games.sort((a,b)=> parseTime(a.time)-parseTime(b.time)); }
    groups = entries;
  } else {
    // group by series
    const bySeries = {};
    for (const g of GAMES){ (bySeries[g.series] ||= []).push(g); }
    const entries = Object.entries(bySeries)
      .map(([series, games]) => ({ key: series, sub:"", games }));
    // sort groups by series priority then alpha
    entries.sort((a,b)=>{
      const pa = seriesPriority(a.key), pb = seriesPriority(b.key);
      return pa===pb ? a.key.localeCompare(b.key,'sv') : pa-pb;
    });
    // sort games inside groups
    if (currentMode === MODE.SERIES_TIME){
      for (const e of entries){ e.games.sort((a,b)=> parseTime(a.time)-parseTime(b.time) || a.arena.localeCompare(b.arena,'sv')); }
    } else {
      for (const e of entries){ e.games.sort((a,b)=>{
        const pa = seriesPriority(a.series), pb = seriesPriority(b.series);
        return (pa-pb) || parseTime(a.time)-parseTime(b.time);
      }); }
    }
    groups = entries;
  }

  // Build DOM
  for (const group of groups){
    const section = document.createElement('section');
    section.className = 'group';
    section.dataset.group = group.key;
    section.dataset.sub = group.sub;

    // group header inside scroller (hidden for active top group via .active)
    const hdr = document.createElement('div');
    hdr.className = 'group-header';
    const htitle = document.createElement('div');
    htitle.className = 'group-h-title';
    htitle.textContent = group.key;
    const hsub = document.createElement('div');
    hsub.className = 'group-h-sub';
    hsub.textContent = group.sub;
    hdr.appendChild(htitle); hdr.appendChild(hsub);
    section.appendChild(hdr);

    // games list
    const list = document.createElement('div'); list.className='games';

    for (const g of group.games){
      // top row variants
      const game = document.createElement('article');
      game.className = 'game';

      const top = document.createElement('div');
      top.className = 'game-top';

      const left = document.createElement('div');
      left.className = 'game-left';
      const tt = document.createElement('div'); tt.className='game-time'; tt.textContent=g.time;
      const ss = document.createElement('div'); ss.className='game-series';
      ss.innerHTML = `<a href="#">${g.series}</a>`;
      left.appendChild(tt); left.appendChild(ss);
      top.appendChild(left);

      if (currentMode !== MODE.PLACE){
        // add Arena + Avst X km on the right in series modes
        const mid = document.createElement('div');
        mid.className = 'game-mid';
        mid.textContent = g.arena;
        const right = document.createElement('div');
        right.className = 'game-right';
        right.textContent = `Avst ${km(g.arena)} km`;
        top.appendChild(mid);
        top.appendChild(right);
      }

      game.appendChild(top);

      // bottom row (same in all modes)
      const bottom = document.createElement('div');
      bottom.className = 'game-bottom';
      bottom.innerHTML = `
        <div class="team">
          <img class="team-logo" src="${g.home.logo}" alt="">
          <span class="team-name">${g.home.name}</span>
        </div>
        <div class="result"><a href="#">${g.result}</a></div>
        <div class="team right">
          <img class="team-logo" src="${g.away.logo}" alt="">
          <span class="team-name">${g.away.name}</span>
        </div>`;
      game.appendChild(bottom);

      list.appendChild(game);
    }

    section.appendChild(list);
    scroll.appendChild(section);
  }

  // update group slot initial text + sticky tracking
  updateActiveGroup(); // sets slot + active class
}

function updateActiveGroup(){
  const sections = Array.from(scroll.querySelectorAll('.group'));
  if (sections.length===0) return;
  const scrollRect = scroll.getBoundingClientRect();
  let current = sections[0];
  for (const s of sections){
    const r = s.getBoundingClientRect();
    if (r.top - scrollRect.top <= 1) current = s; else break;
  }
  // set slot
  const title = current.dataset.group || "";
  const sub   = (currentMode===MODE.PLACE) ? (current.dataset.sub||"") : ""; // only show distance in PLACE
  document.querySelector('#groupSlot .group-title').textContent = title;
  document.querySelector('#groupSlot .group-sub').textContent   = sub;
  // toggle active (hide inner header for current group)
  sections.forEach(s => s.classList.toggle('active', s===current));
}

/* ---------- Pills behavior ---------- */
function applyPillState(){
  // visual
  pillPlace.classList.toggle('on',  currentMode===MODE.PLACE);
  pillPlace.classList.toggle('off', currentMode!==MODE.PLACE);

  pillSeries.classList.toggle('on',  currentMode!==MODE.PLACE);
  pillSeries.classList.toggle('off', currentMode===MODE.PLACE);

  const timeOn = (currentMode===MODE.PLACE) || (currentMode===MODE.SERIES_TIME);
  pillTime.classList.toggle('on',  timeOn);
  pillTime.classList.toggle('off', !timeOn);
  pillTime.classList.toggle('lock', currentMode===MODE.PLACE); // locked in place mode

  // slot subtitle visibility
  const subEl = document.querySelector('#groupSlot .group-sub');
  subEl.style.visibility = (currentMode===MODE.PLACE) ? 'visible' : 'hidden';
}

/* Click handlers */
pillPlace.addEventListener('click', () => {
  currentMode = MODE.PLACE;
  applyPillState();
  render();
});
pillSeries.addEventListener('click', () => {
  // toggle into Series mode (time stays OFF unless already in series_time)
  currentMode = (currentMode===MODE.SERIES || currentMode===MODE.SERIES_TIME) ? currentMode : MODE.SERIES;
  if (currentMode===MODE.PLACE) currentMode = MODE.SERIES;
  applyPillState();
  render();
});
pillTime.addEventListener('click', () => {
  if (currentMode===MODE.PLACE){ // locked ON, do nothing
    return;
  }
  // toggle time within series context
  currentMode = (currentMode===MODE.SERIES) ? MODE.SERIES_TIME : MODE.SERIES;
  applyPillState();
  render();
});

/* Sticky tracking */
const scrollArea = document.getElementById('scrollArea');
scrollArea.addEventListener('scroll', updateActiveGroup, {passive:true});
window.addEventListener('resize', updateActiveGroup, {passive:true});

/* Initial render */
render();
</script>
</body>
</html>

