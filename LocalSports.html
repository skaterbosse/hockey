<!doctype html>
<html lang="sv">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="default" />
<meta name="mobile-web-app-capable" content="yes" />
<title>LocalSport v18.1</title>

<style>
/* ------------- ROOT THEME ------------- */
:root {
  --topbar-h:56px;
  --hint-h:26px;
  --slot-h:42px;
  --bg:#f0f3f8;
  --hair:#e2e8f0;
  --text:#0f172a;
  --muted:#64748b;
  --accent:#16a34a;
  --link:#2563eb;
}

/* ------------- RESET / BASE ------------- */
*{box-sizing:border-box;margin:0;padding:0;}
html,body{height:100%;background:var(--bg);font-family:-apple-system,BlinkMacSystemFont,Roboto,Arial,sans-serif;color:var(--text);overscroll-behavior:none;}
.device{width:100%;height:100dvh;display:flex;flex-direction:column;overflow:hidden;}

/* ------------- TOP BAR ------------- */
.topbar{position:sticky;top:0;z-index:500;background:#fff;border-bottom:1px solid var(--hair);}
.topbar-inner{display:grid;grid-template-columns:1fr auto 1fr;align-items:center;height:var(--topbar-h);padding:6px;}

.cluster-left,.cluster-right{display:flex;gap:8px;align-items:center;}
.icon-btn{width:32px;height:32px;border-radius:10px;border:1px solid var(--hair);background:#f1f5f9;display:grid;place-items:center;cursor:pointer;}

.cluster-center{display:flex;align-items:center;justify-content:center;gap:8px;}
.date-block{display:flex;flex-direction:column;align-items:center;font-weight:700;font-size:13.5px;line-height:1.1;}

/* ------------- SORTERING ------------- */
.sort-stack{border:1px solid var(--hair);border-radius:10px;background:#fff;padding:4px 6px;display:flex;flex-direction:column;align-items:center;}
.sort-top{font-size:12px;font-weight:600;margin-bottom:2px;}
.sort-bottom{display:flex;gap:4px;}

.pill{
  padding:4px 8px;
  font-size:11px;
  border-radius:999px;
  font-weight:600;
  border:1px solid var(--hair);
  cursor:pointer;
  user-select:none;
}
.pill.on{background:#dcfce7;border-color:#86efac;color:var(--accent);}
.pill.off{background:#f1f5f9;border-color:#cbd5e1;color:#94a3b8;}
.pill.lock{opacity:.6;cursor:not-allowed;}

/* ------------- HINT-F√ÑLT ------------- */
.hint{
  position:sticky;
  top:var(--topbar-h);
  height:var(--hint-h);
  background:#fff;
  border-bottom:1px solid var(--hair);
  text-align:center;
  font-size:12px;
  line-height:var(--hint-h);
  color:var(--muted);
  z-index:450;
}

/* ------------- STICKY ARENA SLOT (PLATS) ------------- */
.group-slot{
  position:sticky;
  top:calc(var(--topbar-h) + var(--hint-h));
  height:var(--slot-h);
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:10px 12px;
  font-size:14px;
  font-weight:700;
  background:#fff;
  border-bottom:1px dashed var(--hair);
  z-index:425;
}

/* ------------- SCROLLAREA ------------- */
.scroll{
  flex:1;
  overflow-y:auto;
  -webkit-overflow-scrolling:touch;
  background:var(--bg);
}

/* ------------- ARENA HEADER (i scroll-listan) ------------- */
.arena-header{
  padding:10px 12px;
  background:#fff;
  border-bottom:1px dashed var(--hair);
  font-weight:700;
  display:flex;
  justify-content:space-between;
}
.arena-header.active-hidden{
  visibility:hidden;
  height:0;
  padding:0;
  margin:0;
  border:none;
}

/* ------------- GAME CARDS ------------- */
.game{
  background:#fff;
  border-top:1px dashed #e5e7eb;
  padding:8px 12px;
  display:grid;
  gap:6px;
}

/* top row */
.game-top{display:flex;align-items:center;gap:8px;flex-wrap:nowrap;}
.game-time{font-weight:700;white-space:nowrap;}
.game-series a{text-decoration:none;font-weight:600;color:var(--link);white-space:nowrap;}
.game-mid{flex:1 1 auto;text-align:center;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;font-weight:700;}
.game-right{white-space:nowrap;font-size:12px;color:var(--muted);}

/* bottom row */
.game-bottom{
  display:grid;
  grid-template-columns:1fr auto 1fr;
  align-items:center;
  gap:24px; /* st√∂rre avst√•nd runt resultatf√§ltet */
}

/* Hemma = text f√∂re logo, h√∂gerjusterad */
.team{display:inline-flex;align-items:center;font-weight:600;}
.team.home{justify-content:flex-end;text-align:right;}
.team.home .team-name{order:1;margin-right:6px;max-width:min(38vw,165px);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;font-size:13px;}
.team.home .team-logo{order:2;}

/* Borta = logo f√∂re text, v√§nsterjusterad */
.team.away{justify-content:flex-start;text-align:left;}
.team.away .team-logo{order:1;}
.team.away .team-name{order:2;margin-left:6px;max-width:min(38vw,165px);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;font-size:13px;}

.team-logo{width:26px;height:26px;border-radius:50%;border:1px solid var(--hair);object-fit:cover;background:#eee;}

/* Resultat ‚Äì l√§nk vs icke-l√§nk */
.result a{
  display:inline-block;
  padding:2px 10px;
  border-radius:8px;
  border:1px solid var(--link);
  background:#fff;
  text-decoration:none;
  font-weight:700;
  color:var(--link);
}
.result.no-link{
  font-weight:700;
  padding:2px 10px;
  color:var(--text);
}

/* divider */
.divider{height:7px;background:var(--bg);border-top:1px dashed var(--hair);}

/* Series view: optional divider between series groups */
.series-divider{height:7px;background:var(--bg);border-top:1px dashed var(--hair);}
</style>
</head>

<body>
<div class="device">

<header class="topbar">
  <div class="topbar-inner">
    <div class="cluster-left">
      <button class="icon-btn" title="Hem">üè†</button>
      <button class="icon-btn" title="Karta">üó∫Ô∏è</button>
    </div>

    <div class="cluster-center">
      <button class="icon-btn" id="btnPrev" title="F√∂reg√•ende dag">‚óÄ</button>
      <div class="date-block"><span>Idag</span><span>Tors</span><span>23 okt</span></div>
      <button class="icon-btn" id="btnNext" title="N√§sta dag">‚ñ∂</button>
    </div>

    <div class="cluster-right">
      <div class="sort-stack">
        <div class="sort-top">Sortering</div>
        <div class="sort-bottom">
          <span id="pillPlace" class="pill on">Plats</span>
          <span id="pillSeries" class="pill off">Serie</span>
          <span id="pillTime" class="pill on lock">Tid</span>
        </div>
      </div>
      <button class="icon-btn" title="Inst√§llningar">‚öôÔ∏è</button>
    </div>
  </div>
</header>

<div class="hint">Visar matcher n√§ra: Kruniusv√§gen 1, Billdal</div>

<!-- Sticky arena-slot (d√∂ljs i Serie-vy) -->
<div id="groupSlot" class="group-slot">
  <div class="group-title">Kungsbacka Ishall A</div>
  <div class="group-sub">Avst 8 km</div>
</div>

<!-- SCROLL-LIST -->
<main id="scrollArea" class="scroll"></main>

</div>

<script>
/* ================== KONFIG & DATA ================== */
const LOGOS = {
  hanhals:"logos/Hanhals_IF__b65395a8-4623-46e4-96ab-97ff2e0e7b72.png",
  backen:"logos/B√§cken_HC__119055af-fc61-4108-82a8-a0cd0e883df0.png",
  grastorp:"logos/Gr√§storps_IK__c6811c5f-e2c9-43e2-a9c2-73ab53f63fd1.png",
  kungalv:"logos/Kung√§lvs_IK__620a9df2-1b0b-4bc5-b9eb-7e88670f4c7b.png"
};

/* 5 + 10 matcher ‚Äì med exempel p√• l√§nkar f√∂r vissa resultat */
const GAMES = [
  // Kungsbacka (5)
  { arena:"Kungsbacka Ishall A", series:"HockeyTv√•an S√∂dra", time:"09:00", home:{name:"Hanhals IF",logo:LOGOS.hanhals}, away:{name:"B√§cken HC",logo:LOGOS.backen}, result:"‚Äì", link:"" },
  { arena:"Kungsbacka Ishall A", series:"J18 Region S√∂dra",   time:"09:40", home:{name:"Kung√§lvs IK",logo:LOGOS.kungalv}, away:{name:"Gr√§storps IK",logo:LOGOS.grastorp}, result:"3 - 2", link:"/Game/Events/1010001" },
  { arena:"Kungsbacka Ishall A", series:"J20 Region Syd",     time:"10:20", home:{name:"B√§cken HC U20",logo:LOGOS.backen}, away:{name:"IF M√∂lndal Hockey",logo:LOGOS.hanhals}, result:"‚Äì", link:"" },
  { arena:"Kungsbacka Ishall A", series:"Tr√§ningsmatch",      time:"11:00", home:{name:"Gr√§storps IK J18",logo:LOGOS.grastorp}, away:{name:"Kung√§lvs IK J18",logo:LOGOS.kungalv}, result:"2 - 4", link:"/Game/Events/1010002" },
  { arena:"Kungsbacka Ishall A", series:"HockeyTv√•an V√§stra", time:"11:40", home:{name:"Hisingen Hockey",logo:LOGOS.hanhals}, away:{name:"Partille HK",logo:LOGOS.backen}, result:"‚Äì", link:"" },

  // √Öse & Viste (10)
  { arena:"√Öse & Viste Arena",   series:"HockeyTv√•an S√∂dra",  time:"09:20", home:{name:"Gr√§storps IK",logo:LOGOS.grastorp}, away:{name:"Kung√§lvs IK",logo:LOGOS.kungalv}, result:"‚Äì", link:"" },
  { arena:"√Öse & Viste Arena",   series:"J20 Region Syd",      time:"10:00", home:{name:"Hanhals IF",logo:LOGOS.hanhals}, away:{name:"B√§cken HC",logo:LOGOS.backen}, result:"2 - 2", link:"/Game/Events/1010003" },
  { arena:"√Öse & Viste Arena",   series:"J18 Region S√∂dra",    time:"10:40", home:{name:"Kung√§lvs IK J18",logo:LOGOS.kungalv}, away:{name:"Gr√§storps IK J18",logo:LOGOS.grastorp}, result:"‚Äì", link:"" },
  { arena:"√Öse & Viste Arena",   series:"HockeyTv√•an V√§stra",  time:"11:20", home:{name:"B√§cken HC",logo:LOGOS.backen}, away:{name:"Nybro Vikings IF",logo:LOGOS.backen}, result:"‚Äì", link:"" },
  { arena:"√Öse & Viste Arena",   series:"Tr√§ningsmatch",       time:"12:00", home:{name:"Gr√§storps IK",logo:LOGOS.grastorp}, away:{name:"Hisingen Hockey",logo:LOGOS.hanhals}, result:"4 - 1", link:"/Game/Events/1010004" },
  { arena:"√Öse & Viste Arena",   series:"J20 Region Syd",      time:"12:40", home:{name:"Hanhals IF U20",logo:LOGOS.hanhals}, away:{name:"IF M√∂lndal Hockey",logo:LOGOS.hanhals}, result:"‚Äì", link:"" },
  { arena:"√Öse & Viste Arena",   series:"HockeyTv√•an S√∂dra",   time:"13:20", home:{name:"Kung√§lvs IK",logo:LOGOS.kungalv}, away:{name:"Troja-Ljungby",logo:LOGOS.hanhals}, result:"‚Äì", link:"" },
  { arena:"√Öse & Viste Arena",   series:"J18 Region S√∂dra",    time:"14:00", home:{name:"B√§cken HC J18",logo:LOGOS.backen}, away:{name:"Kalmar HC",logo:LOGOS.backen}, result:"3 - 0", link:"/Game/Events/1010005" },
  { arena:"√Öse & Viste Arena",   series:"HockeyTv√•an V√§stra",  time:"14:40", home:{name:"Gr√§storps IK",logo:LOGOS.grastorp}, away:{name:"Partille HK",logo:LOGOS.backen}, result:"‚Äì", link:"" },
  { arena:"√Öse & Viste Arena",   series:"Tr√§ningsmatch",       time:"15:20", home:{name:"IF M√∂lndal Hockey",logo:LOGOS.hanhals}, away:{name:"K√•llereds SK",logo:LOGOS.hanhals}, result:"‚Äì", link:"" },
];

/* Avst√•nd f√∂r visning (km) */
const ARENAS={ "Kungsbacka Ishall A":8,"√Öse & Viste Arena":104 };

/* ================== HJ√ÑLPARE ================== */
function km(a){return ARENAS[a]??0;}
function parseTime(t){const [H,M]=t.split(':').map(Number);return H*60+M;}
function seriesPriority(s){
  const n=s.toLowerCase();
  if(n.includes('hockeytv√•an'))return 10;
  if(n.includes('j20')||n.includes('u20'))return 14;
  if(n.includes('j18')||n.includes('u18'))return 15;
  if(n.includes('tr√§nings'))return 99;
  return 50;
}
function fullMatchUrl(path){ return path ? ('https://stats.swehockey.se' + path) : ''; }

/* ================== UI REFS ================== */
const pillPlace=document.getElementById('pillPlace');
const pillSeries=document.getElementById('pillSeries');
const pillTime=document.getElementById('pillTime');
const scroll=document.getElementById('scrollArea');
const slot=document.getElementById('groupSlot');
const MODE={PLACE:'place',SERIES:'series',SERIES_TIME:'series_time'};
let mode=MODE.PLACE;

function applyPills(){
  pillPlace.className=(mode===MODE.PLACE)?'pill on':'pill off';
  pillSeries.className=(mode===MODE.SERIES||mode===MODE.SERIES_TIME)?'pill on':'pill off';
  pillTime.className=(mode===MODE.PLACE)?'pill on lock':(mode===MODE.SERIES_TIME?'pill on':'pill off');
}

/* ================== RENDER ================== */
let currentArena=null, arenaOrder=[], lastScrollTop=0;

function gameCard(g, seriesMode=false){
  const a=document.createElement('article'); a.className='game'; a.dataset.arena=g.arena;

  /* top row */
  const top=document.createElement('div'); top.className='game-top';
  if(seriesMode){
    top.innerHTML = `<div class="game-time">${g.time}</div>
      <div class="game-series"><a href="#">${g.series}</a></div>
      <div class="game-mid">${g.arena}</div>
      <div class="game-right">Avst ${km(g.arena)} km</div>`;
  }else{
    top.innerHTML = `<div class="game-time">${g.time}</div>
      <div class="game-series"><a href="#">${g.series}</a></div>`;
  }

  /* bottom row */
  const bottom=document.createElement('div'); bottom.className='game-bottom';

  const home=document.createElement('div'); home.className='team home';
  home.innerHTML = `<span class="team-name">${g.home.name}</span><img class="team-logo" src="${g.home.logo}" alt="">`;

  const res=document.createElement('div'); res.className='result';
  const hasLink = !!g.link && g.result && g.result.trim() !== '‚Äì';
  if(hasLink){
    const aTag=document.createElement('a');
    aTag.href = fullMatchUrl(g.link);
    aTag.target = "_blank";
    aTag.rel="noopener";
    aTag.textContent = g.result;
    res.appendChild(aTag);
  }else{
    res.classList.add('no-link');
    res.textContent = g.result || '‚Äì';
  }

  const away=document.createElement('div'); away.className='team away';
  away.innerHTML = `<img class="team-logo" src="${g.away.logo}" alt=""><span class="team-name">${g.away.name}</span>`;

  bottom.appendChild(home);
  bottom.appendChild(res);
  bottom.appendChild(away);

  a.appendChild(top); a.appendChild(bottom);
  return a;
}

function render(){
  scroll.innerHTML='';

  if(mode===MODE.PLACE){
    slot.style.display='flex';
    const sorted=[...GAMES].sort((a,b)=> km(a.arena)-km(b.arena) || parseTime(a.time)-parseTime(b.time));
    const byArena={}; sorted.forEach(g=> (byArena[g.arena]??=[]).push(g));
    arenaOrder=Object.keys(byArena).sort((a,b)=> km(a)-km(b));
    currentArena = arenaOrder[0] || null;
    if(currentArena){
      slot.querySelector('.group-title').textContent = currentArena;
      slot.querySelector('.group-sub').textContent   = `Avst ${km(currentArena)} km`;
    }
    arenaOrder.forEach((name,idx)=>{
      if(idx>0){ const d=document.createElement('div'); d.className='divider'; scroll.appendChild(d); }
      const hdr=document.createElement('div'); hdr.className='arena-header'; hdr.dataset.arenaHeader=name;
      hdr.innerHTML=`<div>${name}</div><div>Avst ${km(name)} km</div>`;
      if(idx===0) hdr.classList.add('active-hidden');
      scroll.appendChild(hdr);
      byArena[name].forEach(g=> scroll.appendChild(gameCard(g,false)));
    });
    lastScrollTop=scroll.scrollTop;
    updateStickyArena(true);

  } else {
    // SERIES views: stabil scroll (ingen arenarubrik, inget floating)
    slot.style.display='none';
    arenaOrder=[]; currentArena=null;
    const list=[...GAMES];

    if(mode===MODE.SERIES){
      // sortera serier (prio) -> tid
      list.sort((a,b)=> seriesPriority(a.series)-seriesPriority(b.series) || parseTime(a.time)-parseTime(b.time) || a.series.localeCompare(b.series,'sv'));
      // valfri divider mellan serier (visuell gruppering)
      let prev=null;
      list.forEach(g=>{
        if(prev && prev.series!==g.series){
          const div=document.createElement('div'); div.className='series-divider'; scroll.appendChild(div);
        }
        scroll.appendChild(gameCard(g,true));
        prev=g;
      });

    } else { // SERIES_TIME
      // sortera tid -> serie (prio)
      list.sort((a,b)=> parseTime(a.time)-parseTime(b.time) || seriesPriority(a.series)-seriesPriority(b.series) || a.series.localeCompare(b.series,'sv'));
      list.forEach(g=> scroll.appendChild(gameCard(g,true)));
    }
  }
}

/* ================== STICKY ARENA LOGIC (PLATS) ================== */
function updateStickyArena(force=false){
  if(mode!==MODE.PLACE || !arenaOrder.length){ return; }
  const st=scroll.scrollTop;
  const dir=(st>lastScrollTop)?'down':(st<lastScrollTop?'up':'none');
  lastScrollTop=st;

  const slotRect=slot.getBoundingClientRect();
  const stickyBottom=slotRect.bottom;
  const idx=arenaOrder.indexOf(currentArena);

  // Ned√•t: byt n√§r n√§sta header √§r t√§ckt ‚â• 50%
  if(dir==='down' && idx>=0 && idx<arenaOrder.length-1){
    const nh=document.querySelector(`.arena-header[data-arena-header="${arenaOrder[idx+1]}"]`);
    if(nh){
      const r=nh.getBoundingClientRect();
      const covered=Math.max(0, stickyBottom - r.top);
      if(covered >= r.height*0.5){
        currentArena=arenaOrder[idx+1];
      }
    }
  }

  // Upp√•t: byt n√§r aktuella headern √§r helt synlig, med iOS-margin
  if(dir==='up' && idx>0){
    const currHdr=document.querySelector(`.arena-header[data-arena-header="${arenaOrder[idx]}"]`);
    if(currHdr){
      const r=currHdr.getBoundingClientRect();
      const isIOS=/iPhone|iPad|iPod/i.test(navigator.userAgent);
      const extra=isIOS?26:0;
      if(r.top >= stickyBottom + extra){
        currentArena=arenaOrder[idx-1];
      }
    }
  }

  if(force || currentArena){
    slot.querySelector('.group-title').textContent=currentArena;
    slot.querySelector('.group-sub').textContent=`Avst ${km(currentArena)} km`;
    arenaOrder.forEach(name=>{
      const h=document.querySelector(`.arena-header[data-arena-header="${name}"]`);
      if(h) h.classList.toggle('active-hidden', name===currentArena);
    });
  }
}

/* ================== EVENTS ================== */
pillPlace.onclick = ()=>{ mode=MODE.PLACE; applyPills(); render(); };
pillSeries.onclick= ()=>{ mode=MODE.SERIES; applyPills(); render(); };
pillTime.onclick  = ()=>{ if(mode!==MODE.PLACE){ mode=(mode===MODE.SERIES)?MODE.SERIES_TIME:MODE.SERIES; applyPills(); render(); } };

scroll.addEventListener('scroll', ()=> updateStickyArena(false));

/* INIT */
applyPills();
render();
</script>

</body>
</html>

